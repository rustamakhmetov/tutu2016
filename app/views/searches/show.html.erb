<p>
  <strong>Поиск билетов</strong>
</p>

<div class="row">
  <%= form_tag search_path, method: :get do %>
      <div class="col-md-4">
        <%= select_tag :departure_station, options_from_collection_for_select( @stations, "id", "title", @departure_station.try(:id)), class: 'form-control' %>
      </div>
      <div class="col-md-4">
        <%= select_tag :arrival_station, options_from_collection_for_select( @stations, "id", "title", @arrival_station.try(:id)), class: 'form-control' %>
      </div>
      <div class="col-md-4">
        <%= submit_tag 'Искать', class: 'btn btn-primary' %>
      </div>
  <% end %>
</div>

<p>
  <% if @arrival_station && @departure_station %>
    <table class="table">
      <thead>
        <th width="100px">Поезд</th>
        <th width="200px">Маршрут</th>
        <th width="100px">Время отправления</th>
        <th width="100px">Время прибытия</th>
        <th></th>
      </thead>
      <tbody>
        <% @routes.each do |route| %>
            <% route.trains.each do |train| %>
                <tr>
                    <td>
                      <%= train.number %>
                    </td>
                    <td>
                      <%= route.name %>
                    </td>
                    <td>
                        <%= @departure_station.departure_time(route).to_s(:time) %>
                    </td>
                    <td>
                        <%= @arrival_station.arrival_time(route).to_s(:time) %>
                    </td>
                    <td>
                      <% if user_signed_in? %>
                        <%= link_to "Купить", new_user_ticket_path(current_user, ticket: {start_station_id: @departure_station.id, end_station_id: @arrival_station.id, train_id: train.id}) %>
                      <% end %>
                    </td>
                </tr>
            <% end %>
        <% end %>
      </tbody>
    </table>
  <% end %>
</p>

<%= link_to 'На главную', root_path %>